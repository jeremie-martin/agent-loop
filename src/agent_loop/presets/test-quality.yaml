name: test-quality
description: Test suite improvement with self-orchestrated verification

prompt_prefix: |
  FIRST: Find and read all markdown documentation in this project before doing anything else.
  Search for and read: README files (root and subdirectories), CLAUDE.md, AGENTS.md, and all
  files in docs/ or documentation/ directories. Understand the codebase's patterns, conventions,
  and architecture. Only then proceed with your task.

  When spawning sub-agents, explicitly instruct each one to first read all project
  documentation (README files, CLAUDE.md, AGENTS.md, docs/ and documentation/ directories)
  before starting its task.

prompt_suffix: |
  Do not use the "question" tool or any tool requiring user input.
  Stage and commit your changes at the end with a descriptive message.

  CRITICAL: If a test that was passing before your changes now fails, you
  introduced a regression. Fix your changes—do not change the test's assertions.

modes:
  - name: quality
    prompt: |
      Review the test suite for quality. Good tests read as specifications—they
      communicate what the code should do, not just that it runs.

      A reader should understand the tested behavior from the test alone, without
      studying implementation details. Tests should be independent—running them in
      any order produces the same result.

      Refactor tests that are unclear or coupled. Delete tests that are redundant
      or verify nothing meaningful. Leave alone tests that already communicate well.

      **After completing your changes**, orchestrate verification:

      1. Spawn a sub-agent to review your work. Give it:
         - This task (test quality improvement)
         - The test files you modified
         - Instruction to check: do the refactored tests still verify the same
           behavior? Are any regressions introduced? Any further simplification?

      2. Spawn a filter sub-agent. Give it the verification feedback and ask:
         which concerns are genuine vs over-cautious?

      3. Address filtered feedback, then commit.

  - name: consolidation
    prompt: |
      Ensure the test suite doesn't explode in size or redundancy.

      Test suites grow. Each feature adds tests. Without counter-pressure, you
      end up with overlapping tests, tests for code that no longer exists, or
      overly granular tests that could be one.

      Fewer, better tests. Deleting a redundant test is as valuable as adding
      a missing one.

      **After completing your changes**, orchestrate verification:

      1. Spawn a sub-agent to review your work. Give it:
         - This task (test consolidation)
         - The test files you modified
         - Instruction to check: did consolidation preserve test coverage?
           Are any behaviors now untested? Any further consolidation possible?

      2. Spawn a filter sub-agent. Give it the verification feedback and ask:
         which concerns are genuine vs over-cautious?

      3. Address filtered feedback, then commit.
