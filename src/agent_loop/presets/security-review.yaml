name: security-review
description: Review codebase for security vulnerabilities and hardening opportunities

modes:
  - name: input-validation
    prompt: |
      Every input is hostile until proven otherwise. Data from users, files, APIs, databases—all of it can carry surprises.

      Trace data flows from entry points inward. Where does external data enter the system? What happens to it before it's used? Look for: unvalidated input reaching dangerous operations, type confusion, injection opportunities (SQL, command, path, template), deserialization of untrusted data.

      Spawn sub-agents to explore different entry points if the codebase is large—HTTP handlers, CLI parsers, file readers, message consumers.

      Add validation at trust boundaries. Sanitize, escape, or reject bad input before it can cause harm. Prefer allowlists over denylists. Fail closed.

      Commit any changes you make.

  - name: access-control
    prompt: |
      Authorization errors are silent. Unlike crashes, they don't announce themselves—data simply leaks to the wrong eyes.

      Review how the system decides who can do what. Are checks consistent? Are they performed at the right layer? Look for: missing authorization checks, inconsistent enforcement, privilege escalation paths, confused deputy problems, IDOR vulnerabilities.

      Every protected operation should verify authorization. The check should happen as close to the operation as possible, not just at the entry point. When in doubt, deny access.

      Commit any changes you make.

  - name: secrets-and-logging
    prompt: |
      Secrets in code are secrets shared with everyone who can read the repo. Secrets in logs are secrets shared with everyone who can read the logs.

      Search for hardcoded secrets: API keys, passwords, tokens, private keys. These belong in environment variables or secret managers, never in source. Check configuration files, test fixtures, comments, and documentation too.

      Review logging for sensitive data exposure. Passwords, tokens, PII, financial data—none of it should appear in logs, even at debug level. Ensure errors don't leak stack traces or internal details to end users.

      Commit any changes you make.
